{
  "$id": "playbook.json",
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Playbook Step",
  "description": "",
  "type": "object",
  "properties": {
    "type": {
      "type": "string",
      "description": "The value of this property MUST be playbook or playbook-template. See section 1.2, section 1.3, and section 1.4 respectively, for information about executable playbooks and playbook templates.",
      "enum": [
        "playbook",
        "playbook-template"
      ]
    },
    "spec_version": {
      "type": "string",
      "description": "The version of the specification used to represent this playbook. The value of this property MUST be \"1.1\" to represent the version of this specification.",
      "enum": [
        "1.1"
      ]
    },
    "id": {
      "$ref": "identifier.json",
      "description": "A value that uniquely identifies the playbook. All playbooks with the same id are considered different versions of the same playbook and the version of the playbook is identified by its modified property."
    },
    "name": {
      "type": "string",
      "description": "A simple name for this playbook. This name is not guaranteed or required to be unique."
    },
    "description": {
      "type": "string",
      "description": "More details, context, and possibly an explanation about what this playbook does and tries to accomplish. Producers SHOULD populate this property."
    },
    "playbook_types": {
      "type": "array",
      "description": "A list of playbook types that specifies the operational functions this playbook addresses.  The values for this property MUST come from the playbook-type vocabulary.",
      "items": {
        "$ref": "#/$defs/playbook-type-ov"
      },
      "minItems": 1
    },
    "created_by": {
      "$ref": "identifier.json",
      "description": "An ID that represents the entity that created this playbook. The ID MUST represent a STIX 2.1+ identity object."
    },
    "created": {
      "$ref": "timestamp.json",
      "description": "The time at which this playbook was originally created. The creator can use any time it deems most appropriate as the time the playbook was created, but it MUST be precise to the nearest millisecond (exactly three digits after the decimal place in seconds). The created property MUST NOT be changed when creating a new version of the object."
    },
    "modified": {
      "$ref": "timestamp.json",
      "description": "The time that this particular version of the playbook was last modified. The creator can use any time it deems most appropriate as the time that this version of the playbook was modified, but it MUST be precise to the nearest millisecond (exactly three digits after the decimal place in seconds). The modified property MUST be later than or equal to the value of the created property."
    },
    "revoked": {
      "type": "boolean",
      "description": "A boolean that identifies if the playbook creator deems that this playbook is no longer valid. The default value is \"false\"."
    },
    "valid_from": {
      "$ref": "timestamp.json",
      "description": "The time from which this playbook is considered valid and the steps that it contains can be executed. More detailed information about time frames MAY be applied in the workflow.  If omitted, the playbook is valid at all times or until the timestamp defined by valid_until."
    },
    "valid_until": {
      "$ref": "timestamp.json",
      "description": "The time at which this playbook should no longer be considered a valid playbook to be executed.  If the valid_until property is omitted, then there is no constraint on the latest time for which the playbook is valid.  This property MUST be greater than the timestamp in the valid_from property if the valid_from property is defined."
    },
    "derived_from": {
      "type": "array",
      "description": "The ID of one or more playbooks that this playbook was derived from.  The ID MUST represent a CACAO playbook object.",
      "items": {
        "$ref": "identifier.json"
      }
    },
    "priority": {
      "type": "integer",
      "minimum": 0,
      "maximum": 100,
      "description": "A positive integer that represents the priority of this playbook relative to other defined playbooks.  Priority is a subjective assessment by the producer based on the context in which the playbook can be shared. Marketplaces and sharing organizations MAY define rules on how priority should be assessed and assigned. This property is primarily to allow such usage without requiring the addition of a custom field for such practices.  If specified, the value of this property MUST be between 0 and 100.  When left blank this means unspecified. A value of 0 means specifically undefined. Values range from 1, the highest priority, to a value of 100, the lowest."
    },
    "severity": {
      "type": "integer",
      "minimum": 0,
      "maximum": 100,
      "description": "A positive integer that represents the seriousness of the conditions that this playbook addresses. This is highly dependent on whether it's an incident (in which cases the severity can be mapped to the incident category) or a response to a threat (in which case the severity would likely be mapped to the severity of threat faced or captured by threat intelligence).  Marketplaces and sharing organizations MAY define additional rules for how this property should be assigned.  If specified, the value of this property MUST be between 0 and 100.  When left blank this means unspecified. A value of 0 means specifically undefined. Values range from 1, the lowest severity, to a value of 100, the highest."
    },
    "impact": {
      "type": "integer",
      "minimum": 0,
      "maximum": 100,
      "description": "A positive integer that represents the impact the playbook has on the organization, not what triggered the playbook in the 1st place such as a threat or an incident. For example, a purely investigative playbook that is non-invasive would have a low impact value (1), whereas a playbook that makes firewall changes, IPS changes, moves laptops to quarantine etc., would have a higher impact value. If specified, the value of this property MUST be between 0 and 100.  When left blank this means unspecified. A value of 0 means specifically undefined. Values range from 1, the lowest impact, to a value of 100, the highest."
    },
    "industry_sectors": {
      "type": "array",
      "description": "A list of industry sectors that this playbook is applied to.  The values for this property SHOULD come from the industry-sector-ov vocabulary.",
      "items": {
        "$ref": "#/$defs/industry-sector-ov"
      }
    },
    "labels": {
      "type": "array",
      "description": "An optional set of terms, labels, or tags associated with this playbook. The values may be user, organization, or trust-group defined and their meaning is outside the scope of this specification.",
      "items": {
        "type": "string"
      }
    },
    "external_references": {
      "type": "array",
      "description": "An optional list of external references for this playbook or content found in this playbook.",
      "items": {
        "$ref": "external_reference.json"
      }
    },
    "features": {
      "type": "array",
      "description": "An optional property that contains a list of features that are enabled for this playbook.",
      "items": {
        "$ref": "#/$defs/playbook-features-ov"
      }
    },
    "markings": {
      "type": "array",
      "description": "An optional list of data marking objects that apply to this playbook. In some cases, though uncommon, data markings themselves may be marked with sharing or handling guidance. In this case, this property MUST NOT contain any references to the same data marking object (i.e., it cannot contain any circular references).  The IDs MUST represent a CACAO data marking object.",
      "items": {
        "$ref": "identifier.json"
      }
    },
    "playbook_variables": {
      "$ref": "dictionary.json",
      "description": "This property contains the variables that can be used within this playbook or within workflow steps, commands, and targets defined within this playbook. See section 9.13 for information about referencing variables.  The key for each entry in the dictionary MUST be a string that uniquely identifies the variable. The value for each key MUST be a CACAO variable data type (see section 9.13)."
    },
    "workflow_start": {
      "$ref": "identifier.json",
      "description": "The first workflow step included in the workflow property that MUST be executed when starting the workflow.  The ID MUST represent a CACAO workflow step object."
    },
    "workflow_exception": {
      "$ref": "identifier.json",
      "description": "The workflow step invoked whenever a playbook exception condition occurs.  The ID MUST represent a CACAO workflow step object."
    },
    "workflow": {
      "description": "The workflow property contains the processing logic for the playbook as workflow steps.  The key for each entry in the dictionary MUST be an identifier that uniquely identifies the workflow step. The id MUST use the object type of \"step\" (see section 9.8 for more information on identifiers). The value for each key MUST be a CACAO workflow step object (see section 4).",
      "type": "object",
      "unevaluatedProperties": false,
      "patternProperties": {
        "^step--[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[1-5][0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12}$": {
          "anyOf": [
            {
              "$ref": "while_condition_step.json"
            },
            {
              "$ref": "single_action_step.json"
            },
            {
              "$ref": "playbook_step.json"
            },
            {
              "$ref": "end_step.json"
            },
            {
              "$ref": "start_step.json"
            },
            {
              "$ref": "switch_condition_step.json"
            },
            {
              "$ref": "if_condition_step.json"
            },
            {
              "$ref": "parallel_step.json"
            }
          ]
        }
      }
    },
    "targets": {
      "minProperties": 1,
      "type": "object",
      "patternProperties": {
        "^target--[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[1-5][0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12}$": {
          "anyOf": [
            {"$ref": "individual_target.json"},
            {"$ref": "group_target.json"},
            {"$ref": "organization_target.json"},
            {"$ref": "location_target.json"},
            {"$ref": "sector_target.json"},
            {"$ref": "http_api_target.json"},
            {"$ref": "ssh_target.json"},
            {"$ref": "security_infrastructure_category_target.json"},
            {"$ref": "net_address_target.json"},
            {"$ref": "kali_target.json"},
            {"$ref": "attacker_target.json"},
            {"$ref": "attack_agent_target.json"},
            {"$ref": "attack_group_target.json"}
          ]
        }
      },
      "description": "A dictionary of targets that can be referenced from workflow steps found in the workflow property.  The key for each entry in the dictionary MUST be an identifier that uniquely identifies the target. The id MUST use the object type of \"target\" (see section 9.8 for more information on identifiers). The value for each key MUST be a CACAO target object (see section 6)."
    },
    "extension_definitions": {
      "type": "object",
      "unevaluatedProperties": false,
      "patternProperties": {
        "^extension-definition--[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[1-5][0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12}$": {
          "$ref": "extension_definition.json"
        }
      },
      "description": "A dictionary of extension definitions that are referenced from workflow steps found in the workflow property.  The key for each entry in the dictionary MUST be an identifier that uniquely identifies the extension. The id MUST use the object type of \"extension\" (see section 9.8 for more information on identifiers). The value for each key MUST be a CACAO extension object (see section 7)."
    },
    "data_marking_definitions": {
      "type": "object",
      "unevaluatedProperties": false,
      "description": "A dictionary of data marking definitions that can be referenced from the playbook found in the markings property.  The key for each entry in the dictionary MUST be an identifier that uniquely identifies the data marking. The id MUST use an object type of one of the data marking objects defined in section 8, for example \"marking-statement\" (see section 9.8 for more information on identifiers). The value for each key MUST be a CACAO data marking object (see section 8).",
      "patternProperties": {
        "^marking-tlp--[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[1-5][0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12}$": {
          "$ref": "marking_tlp_data_marking.json"
        },"^marking-iep--[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[1-5][0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12}$": {
          "$ref": "marking_iep_data_marking.json"
        },"^marking-statement--[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[1-5][0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12}$": {
          "$ref": "marking_statement_data_marking.json"
        }
      }
    },
    "signatures": {
      "type": "array",
      "description": "An optional list of digital signatures for this playbook. Adding a signature to a playbook does not represent a version change of the playbook. See sections 2.5, 9.10, and A.2 in the appendix for a detailed example.",
      "items": {
        "$ref": "signature.json"
      }
    }
  },
  "required": [
    "type",
    "spec_version",
    "id",
    "name",
    "playbook_types",
    "created_by",
    "created",
    "modified"
  ],
  "$defs": {
    "type-ov": {
      "type": "string",
      "enum": [
        "playbook",
        "playbook-template"
      ]
    },
    "playbook-type-ov": {
      "type": "string",
      "enum": [
        "notification",
        "detection",
        "investigation",
        "prevention",
        "mitigation",
        "remediation",
        "attack"
      ]
    },
    "industry-sector-ov": {
      "type": "string",
      "enum": [
        "aerospace",
        "aviation",
        "agriculture",
        "automotive",
        "biotechnology",
        "chemical",
        "commercial",
        "consulting",
        "construction",
        "cosmetics",
        "critical-infrastructure",
        "dams",
        "defense",
        "education",
        "emergency-services",
        "energy",
        "non-renewable-energy",
        "renewable-energy",
        "media",
        "financial",
        "food",
        "gambling",
        "government",
        "local-government",
        "national-government",
        "regional-government",
        "public-services",
        "healthcare",
        "information-communications-technology",
        "electronics-hardware",
        "software",
        "telecommunications",
        "legal-services",
        "lodging",
        "manufacturing",
        "maritime",
        "metals",
        "mining",
        "non-profit",
        "humanitarian-aid",
        "human-rights",
        "nuclear",
        "petroleum",
        "pharmaceuticals",
        "research",
        "transportation",
        "logistics-shipping",
        "utilities",
        "video-game",
        "water"
      ]
    },
    "playbook-features-ov": {
      "type": "string",
      "enum": [
        "parallel_processing",
        "if_logic",
        "while_logic",
        "switch_logic",
        "temporal_logic",
        "data_markings",
        "extensions"
      ]
    }
  },
  "unevaluatedProperties": false
}